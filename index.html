</script>

    <!-- 3. React App logic only - Babel will now run much faster -->
    <script type="text/babel">
      const { useState, useEffect, Fragment, useRef } = React;

      const IconSettings = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#C5A059" strokeWidth="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l-.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l-.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l-.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>;
      const IconBack = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#C5A059" strokeWidth="2.5"><path d="m15 18-6-6 6-6"/></svg>;

      const THEMES = {
        teal: { id: 'teal', bg: '#051F22', text: '#E2D1A7', card: '#06282d', accent: '#C5A059' },
        dark: { id: 'dark', bg: '#121212', text: '#E0E0E0', card: '#1E1E1E', accent: '#D4AF37' },
        cream: { id: 'cream', bg: '#FCFBF4', text: '#2D241E', card: '#FFF', accent: '#C5A059' }
      };

      const App = () => {
        const [activePageId, setActivePageId] = useState(null);
        const [showSettings, setShowSettings] = useState(false);
        const [theme, setTheme] = useState(THEMES.teal);
        const [fontScale, setFontScale] = useState(0);
        const scrollRef = useRef(null);

        useEffect(() => {
          const splash = document.getElementById('splash-overlay');
          if (splash) {
            splash.style.opacity = '0';
            setTimeout(() => { splash.style.display = 'none'; }, 400);
          }
        }, []);

        useEffect(() => { if (scrollRef.current) scrollRef.current.scrollTop = 0; }, [activePageId]);

        const clean = (t) => t ? t.replace(/Ûž/g, '') : '';

        const renderBlock = (block, idx, blockId) => {
          if (!block) return null;
          const aSize = 32 + (fontScale * 2);
          const eSize = 17 + (fontScale * 1);
          switch (block.type) {
            case 'section-title': case 'title-green':
              return <h3 id={blockId} key={idx} className="text-center font-heading font-bold text-[13px] mb-6 pb-2 border-b border-[#C5A059]/30 uppercase text-[#C5A059]">{block.text}</h3>;
            
            case 'arabic': case 'arabic-indopak':
              // FIX: leading-[1.2] pulls the Arabic lines together (Line Sorter)
              return <p key={idx} dir="rtl" className="font-arabic mb-3 text-center font-bold px-1 leading-[1.2]" style={{ color: theme.id === 'cream' ? '#000' : theme.text, fontSize: `${aSize}px` }}>{clean(block.text)}</p>; 
            
            case 'arabic-green':
              return <p key={idx} dir="rtl" className="font-arabic mb-3 text-center font-bold px-1 text-[#2D8A4E] leading-[1.2]" style={{ fontSize: `${aSize}px` }}>{clean(block.text)}</p>; 
            
            case 'text':
              // FIX: Wider padding (px-2) so English uses fewer lines
              return <p key={idx} className="text-center font-sans mb-6 opacity-90 leading-snug font-medium px-2" style={{ color: theme.id === 'cream' ? '#333' : theme.text, fontSize: `${eSize}px` }}>{block.text}</p>; 
            
            case 'hr': 
              // FIX: Thin divider line exactly like your Quran picture
              return <div key={idx} className="h-[0.5px] w-full bg-[#C5A059]/20 my-8" />;

            case 'allah-name': 
              return (
                <div key={idx} className="mb-6 border-b border-white/5 pb-3 text-center"> 
                  <div className="flex justify-between items-center">
                    <span className="font-bold text-lg text-[#FF4444]">{block.number}</span>
                    <span className="font-arabic font-bold text-[#4488FF]" style={{ fontSize: '36px' }}>{clean(block.arabic)}</span>
                  </div>
                  <div className="font-bold opacity-60 text-[12px] text-[#FF4444] uppercase">{block.english}</div>
                </div>
              );
            case 'subtitle-green':
              return <p key={idx} dir="rtl" className="text-center font-arabic mb-4 text-[#2D8A4E] text-xl">{clean(block.text)}</p>;
            default: return null;
          }
        };

        const renderPage = () => {
          const page = PAGES_DATA[activePageId];
          const jumps = [];
          let jId = 0;
          page?.cards.forEach(card => card.content.forEach(block => {
            if (block.type === 'section-title' || block.type === 'title-green') {
              const uid = `nav-${activePageId}-${jId++}`;
              block._jumpId = uid;
              jumps.push({ text: block.text, id: uid });
            }
          }));

          return (
            <Fragment>
              <div className="flex flex-col w-full sticky top-0 z-50 shadow-sm" style={{backgroundColor: theme.bg}}>
                <div className="flex items-center justify-center relative w-full h-14 px-4 border-b border-white/5">
                  <button onClick={() => setActivePageId(null)} className="absolute left-4 p-1"><IconBack /></button>
                  <h1 className="font-heading font-bold text-[14px] uppercase text-[#C5A059] tracking-widest">{page.title}</h1>
                  <button onClick={() => setShowSettings(true)} className="absolute right-4 p-1"><IconSettings /></button>
                </div>
                {jumps.length > 0 && (
                  <div className="index-bar flex items-center gap-2 overflow-x-auto py-2 px-3 no-scrollbar border-b border-white/5" style={{backgroundColor: 'rgba(0,0,0,0.2)'}}>
                    {jumps.map((t, i) => (
                      <button key={i} onClick={() => {document.getElementById(t.id)?.scrollIntoView({behavior:'smooth', block:'center'})}} 
                        className="whitespace-nowrap px-4 py-1.5 rounded-full text-[10px] font-bold border uppercase"
                        style={{ borderColor: '#C5A059', color: '#C5A059' }}>
                        {t.text}
                      </button>
                    ))}
                  </div>
                )}
              </div>
              
              <main ref={scrollRef} className="main-content animate-in" style={{ backgroundColor: theme.bg }}>
                <div className="max-w-md mx-auto px-2 pt-4 pb-20">
                  {page.cards.map((card, idx) => (
                    // FIX: Reduced padding (p-4) to allow text to be wider and shorter
                    <div key={idx} className="mb-6 p-4 border border-[#C5A059]/10 rounded-[1.5rem]" style={{ backgroundColor: theme.card }}>
                      {card.content.map((block, bIdx) => renderBlock(block, bIdx, block._jumpId))}
                    </div>
                  ))}
                </div>
              </main>
            </Fragment>
          );
        };

        const renderMenu = () => (
          <Fragment>
            <div className="flex items-center justify-center h-16 w-full sticky top-0 z-50" style={{backgroundColor: '#051F22', borderBottom: '1px solid rgba(197, 160, 89, 0.2)'}}>
               <h1 className="font-heading font-bold text-xl text-[#C5A059] uppercase tracking-widest">Qalb-e-Dua</h1>
               <button onClick={() => setShowSettings(true)} className="absolute right-6 p-1"><IconSettings /></button>
            </div>
            <main className="main-content" style={{backgroundColor: '#051F22'}}>
              <div className="mihrab-container px-4 pt-6">
                <div className="max-w-md mx-auto">
                  {MENU_ITEMS.map((item) => (
                    <button key={item.id} onClick={() => setActivePageId(item.pageId)} className="dua-btn mb-3 py-4 text-lg">{item.label}</button>
                  ))}
                </div>
              </div>
            </main>
          </Fragment>
        );

        return (
          <div className="flex flex-col h-full overflow-hidden" style={{ backgroundColor: activePageId ? theme.bg : '#051F22' }}>
            {activePageId ? renderPage() : renderMenu()}
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
</body>
</html>
